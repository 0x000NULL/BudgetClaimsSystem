<!-- Display flash messages -->
<% if (messages.error && messages.error.length > 0) { %>
  <div class="alert alert-danger" role="alert">
    <% messages.error.forEach(function(msg) { %>
      <p class="mb-0"><%= msg %></p>
    <% }); %>
  </div>
<% } %>
<% if (messages.success && messages.success.length > 0) { %>
  <div class="alert alert-success" role="alert">
    <% messages.success.forEach(function(msg) { %>
      <p class="mb-0"><%= msg %></p>
    <% }); %>
  </div>
<% } %>

<div class="container mt-4">
  <div class="row justify-content-center">
    <div class="col-md-8">
      <div class="card shadow">
        <div class="card-header bg-primary text-white">
          <h4 class="mb-0">Auto Generate Claim from Rental Agreement</h4>
        </div>
        <div class="card-body">
          <div class="upload-container text-center p-5 mb-4 bg-light rounded">
            <form id="uploadForm" action="/claims/auto-generate" method="POST" enctype="multipart/form-data">
              <div class="upload-zone" id="drop-zone">
                <i class="fas fa-cloud-upload-alt fa-3x mb-3"></i>
                <h5>Drag & Drop Rental Agreement Here</h5>
                <p class="text-muted">or</p>
                <label for="rentalAgreement" class="btn btn-outline-primary">
                  Choose File
                  <input type="file" id="rentalAgreement" name="rentalAgreement" class="d-none" accept=".pdf,.doc,.docx">
                </label>
                <p class="mt-2 text-muted small">Supported formats: PDF, DOC, DOCX</p>
              </div>

              <div id="file-preview" class="mt-3 d-none">
                <div class="selected-file p-3 bg-white rounded border">
                  <i class="fas fa-file-pdf text-danger"></i>
                  <span id="selected-filename" class="ml-2"></span>
                  <button type="button" class="btn btn-sm btn-link text-danger" id="remove-file">
                    <i class="fas fa-times"></i>
                  </button>
                </div>
              </div>

              <button type="submit" class="btn btn-primary mt-4" id="submit-btn" disabled>
                <i class="fas fa-magic mr-2"></i>Generate Claim
              </button>
            </form>
          </div>

          <div class="info-section mt-4">
            <h5>What happens next?</h5>
            <ul class="list-unstyled">
              <li class="mb-2">
                <i class="fas fa-check-circle text-success mr-2"></i>
                System will extract information from the rental agreement
              </li>
              <li class="mb-2">
                <i class="fas fa-check-circle text-success mr-2"></i>
                A new claim will be automatically generated
              </li>
              <li class="mb-2">
                <i class="fas fa-check-circle text-success mr-2"></i>
                You'll be redirected to review the generated claim
              </li>
              <li class="mb-2">
                <i class="fas fa-check-circle text-success mr-2"></i>
                Notifications will be sent to relevant team members
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
.upload-zone {
  border: 2px dashed #ccc;
  border-radius: 8px;
  padding: 2rem;
  transition: all 0.3s ease;
  cursor: pointer;
}

.upload-zone:hover {
  border-color: #007bff;
  background-color: #f8f9fa;
}

.upload-zone.dragover {
  border-color: #28a745;
  background-color: #e8f5e9;
}

.selected-file {
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.mr-2 {
  margin-right: 0.5rem;
}

.ml-2 {
  margin-left: 0.5rem;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const dropZone = document.getElementById('drop-zone');
  const fileInput = document.getElementById('rentalAgreement');
  const filePreview = document.getElementById('file-preview');
  const selectedFilename = document.getElementById('selected-filename');
  const removeFileBtn = document.getElementById('remove-file');
  const submitBtn = document.getElementById('submit-btn');

  // Drag and drop handlers
  dropZone.addEventListener('dragover', (e) => {
    e.preventDefault();
    dropZone.classList.add('dragover');
  });

  dropZone.addEventListener('dragleave', () => {
    dropZone.classList.remove('dragover');
  });

  dropZone.addEventListener('drop', (e) => {
    e.preventDefault();
    dropZone.classList.remove('dragover');
    const files = e.dataTransfer.files;
    if (files.length) {
      fileInput.files = files;
      updateFilePreview();
    }
  });

  // Click to upload
  dropZone.addEventListener('click', () => {
    fileInput.click();
  });

  fileInput.addEventListener('change', updateFilePreview);

  // Remove file handler
  removeFileBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    fileInput.value = '';
    filePreview.classList.add('d-none');
    submitBtn.disabled = true;
  });

  function updateFilePreview() {
    if (fileInput.files.length) {
      selectedFilename.textContent = fileInput.files[0].name;
      filePreview.classList.remove('d-none');
      submitBtn.disabled = false;
    } else {
      filePreview.classList.add('d-none');
      submitBtn.disabled = true;
    }
  }
});
</script> 