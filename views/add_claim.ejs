<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"> <!-- Set the character encoding for the document -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Ensure proper rendering and touch zooming on mobile devices -->
    <title>Add Claim - Vortex Claims System</title> <!-- Title of the document -->
    <link rel="stylesheet" href="/css/styles.css"> <!-- Link to external CSS for styling -->
    <style>
        /* Styles for buttons */
        .btn {
            display: inline-block;
            padding: 8px 12px;
            margin: 5px;
            background-color: #007bff;
            color: white;
            text-align: center;
            text-decoration: none;
            border-radius: 4px;
        }

        .btn:hover {
            background-color: #0056b3;
        }

        /* Container for the main content */
        .container {
            max-width: 800px;
            margin: auto;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f9f9f9;
        }

        /* Styles for the claim information section */
        .claim-info {
            margin-bottom: 20px;
        }

        .claim-info label {
            font-weight: bold;
        }

        .claim-info input, .claim-info textarea, .claim-info select {
            width: 100%;
            padding: 8px;
            margin: 5px 0 15px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        /* Styles for file upload sections */
        .file-section {
            margin-bottom: 20px;
        }

        .file-section h3 {
            margin-bottom: 10px;
        }

        .file-section input {
            margin-bottom: 10px;
        }

        /* Button group styles */
        .button-group {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
        }

        /* Styles for dynamic fields (e.g., adding new statuses, locations, etc.) */
        .dynamic-field-container {
            display: flex;
            align-items: center;
        }

        .dynamic-field-container input {
            width: auto;
            flex-grow: 1;
        }

        .dynamic-field-container .add-btn {
            margin-left: 10px;
            background-color: green;
        }

        .dynamic-field-container .remove-btn {
            background-color: red;
            color: white;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <header>
        <!-- Logo and navigation -->
        <img src="/images/VortexITLogo.png" alt="Vortex Logo" class="logo"> <!-- Company logo -->
        <h1>Vortex Claims System</h1> <!-- Main heading -->
        <nav>
            <ul>
                <li><a href="/dashboard">Dashboard</a></li> <!-- Link to Dashboard -->
                <li class="Claims">
                    <a href="javascript:void(0)" class="dropbtn">Claims</a> <!-- Dropdown trigger -->
                    <div class="dropdown-content">
                        <a href="/claims/search">Search Claims</a> <!-- Link to Search Claims -->
                        <a href="/claims/add">Add Claim</a> <!-- Link to Add Claim -->
                    </div>
                </li>
                <li><a href="/reports">Reports</a></li> <!-- Link to Reports -->
                <li class="Settings">
                    <a href="javascript:void(0)" class="dropbtn">Settings</a> <!-- Dropdown trigger -->
                    <div class="dropdown-content">
                        <a href="/user-management">User Management</a> <!-- Link to User Management -->
                        <a href="/email-templates">Email Templates</a> <!-- Link to Email Templates -->
                    </div>
                </li>
                <li><a href="/help">Help</a></li> <!-- Link to Help -->
                <li><a href="/logout">Logout</a></li> <!-- Link to Logout -->
            </ul>
        </nav>
    </header>
    <main>
        <div class="container">
            <h2>Add Claim</h2> <!-- Section heading -->
            <form action="/claims" method="POST" enctype="multipart/form-data"> <!-- Form to add a new claim -->
                <div class="claim-info">
                    <!-- MVA field -->
                    <label for="mva">MVA:</label>
                    <input type="text" id="mva" name="mva">

                    <!-- Customer Name field -->
                    <label for="customerName">Customer Name:</label>
                    <input type="text" id="customerName" name="customerName">

                    <!-- Customer Number field -->
                    <label for="customerNumber">Customer Number:</label>
                    <input type="text" id="customerNumber" name="customerNumber">

                    <!-- Customer Email field -->
                    <label for="customerEmail">Customer Email:</label>
                    <input type="email" id="customerEmail" name="customerEmail">

                    <!-- Customer Address field -->
                    <label for="customerAddress">Customer Address:</label>
                    <input type="text" id="customerAddress" name="customerAddress">

                    <!-- Customer Drivers License field -->
                    <label for="customerDriversLicense">Customer Drivers License:</label>
                    <input type="text" id="customerDriversLicense" name="customerDriversLicense">

                    <!-- Car Make field -->
                    <label for="carMake">Car Make:</label>
                    <input type="text" id="carMake" name="carMake">

                    <!-- Car Model field -->
                    <label for="carModel">Car Model:</label>
                    <input type="text" id="carModel" name="carModel">

                    <!-- Car Year field -->
                    <label for="carYear">Car Year:</label>
                    <input type="text" id="carYear" name="carYear">

                    <!-- Car Color field -->
                    <label for="carColor">Car Color:</label>
                    <input type="text" id="carColor" name="carColor">

                    <!-- Car VIN field -->
                    <label for="carVIN">Car VIN:</label>
                    <input type="text" id="carVIN" name="carVIN">

                    <!-- Accident Date field -->
                    <label for="accidentDate">Accident Date:</label>
                    <input type="date" id="accidentDate" name="accidentDate">

                    <!-- Billable field -->
                    <label for="billable">Billable:</label>
                    <select id="billable" name="billable">
                        <option value="true">Yes</option>
                        <option value="false">No</option>
                    </select>

                    <!-- Is Renter At Fault field -->
                    <label for="isRenterAtFault">Is Renter At Fault:</label>
                    <select id="isRenterAtFault" name="isRenterAtFault">
                        <option value="true">Yes</option>
                        <option value="false">No</option>
                    </select>

                    <!-- Damages Total field -->
                    <label for="damagesTotal">Damages Total:</label>
                    <input type="text" id="damagesTotal" name="damagesTotal">

                    <!-- Body Shop Name field -->
                    <label for="bodyShopName">Body Shop Name:</label>
                    <input type="text" id="bodyShopName" name="bodyShopName">

                    <!-- RA Number field -->
                    <label for="raNumber">RA Number:</label>
                    <input type="text" id="raNumber" name="raNumber">

                    <!-- Insurance Carrier field -->
                    <label for="insuranceCarrier">Insurance Carrier:</label>
                    <input type="text" id="insuranceCarrier" name="insuranceCarrier">

                    <!-- Insurance Adjuster field -->
                    <label for="insuranceAdjuster">Insurance Adjuster:</label>
                    <input type="text" id="insuranceAdjuster" name="insuranceAdjuster">

                    <!-- Insurance Email field -->
                    <label for="insuranceEmail">Insurance Email:</label>
                    <input type="email" id="insuranceEmail" name="insuranceEmail">

                    <!-- Insurance Phone Number field -->
                    <label for="insurancePhoneNumber">Insurance Phone Number:</label>
                    <input type="text" id="insurancePhoneNumber" name="insurancePhoneNumber">

                    <!-- Insurance Fax Number field -->
                    <label for="insuranceFaxNumber">Insurance Fax Number:</label>
                    <input type="text" id="insuranceFaxNumber" name="insuranceFaxNumber">

                    <!-- Insurance Address field -->
                    <label for="insuranceAddress">Insurance Address:</label>
                    <input type="text" id="insuranceAddress" name="insuranceAddress">

                    <!-- Insurance Policy Number field -->
                    <label for="insurancePolicyNumber">Insurance Policy Number:</label>
                    <input type="text" id="insurancePolicyNumber" name="insurancePolicyNumber">

                    <!-- Insurance Claim Number field -->
                    <label for="insuranceClaimNumber">Insurance Claim Number:</label>
                    <input type="text" id="insuranceClaimNumber" name="insuranceClaimNumber">

                    <!-- Third Party Name field -->
                    <label for="thirdPartyName">Third Party Name:</label>
                    <input type="text" id="thirdPartyName" name="thirdPartyName">

                    <!-- Third Party Address field -->
                    <label for="thirdPartyAddress">Third Party Address:</label>
                    <input type="text" id="thirdPartyAddress" name="thirdPartyAddress">

                    <!-- Third Party Phone Number field -->
                    <label for="thirdPartyPhoneNumber">Third Party Phone Number:</label>
                    <input type="text" id="thirdPartyPhoneNumber" name="thirdPartyPhoneNumber">

                    <!-- Third Party Insurance Name field -->
                    <label for="thirdPartyInsuranceName">Third Party Insurance Name:</label>
                    <input type="text" id="thirdPartyInsuranceName" name="thirdPartyInsuranceName">

                    <!-- Third Party Adjuster Name field -->
                    <label for="thirdPartyAdjusterName">Third Party Adjuster Name:</label>
                    <input type="text" id="thirdPartyAdjusterName" name="thirdPartyAdjusterName">

                    <!-- Third Party Policy Number field -->
                    <label for="thirdPartyPolicyNumber">Third Party Policy Number:</label>
                    <input type="text" id="thirdPartyPolicyNumber" name="thirdPartyPolicyNumber">

                    <!-- Third Party Claim Number field -->
                    <label for="thirdPartyClaimNumber">Third Party Claim Number:</label>
                    <input type="text" id="thirdPartyClaimNumber" name="thirdPartyClaimNumber">

                    <!-- Renting Location field with dynamic addition -->
                    <label for="rentingLocation">Renting Location:</label>
                    <select id="rentingLocation" name="rentingLocation">
                        <% locations.forEach(location => { %> <!-- Loop through locations from the database -->
                            <option value="<%= location %>"><%= location %></option>
                        <% }) %>
                    </select>
                    <div class="dynamic-field-container">
                        <input type="text" id="newLocation" placeholder="New Location"> <!-- Input for adding a new location -->
                        <button type="button" class="btn add-btn" onclick="addLocation()">Add Location</button> <!-- Button to add the new location -->
                    </div>

                    <!-- LDW Accepted field -->
                    <label for="ldwAccepted">LDW Accepted:</label>
                    <select id="ldwAccepted" name="ldwAccepted">
                        <option value="true">Yes</option>
                        <option value="false">No</option>
                    </select>

                    <!-- Police Department field -->
                    <label for="policeDepartment">Police Department:</label>
                    <input type="text" id="policeDepartment" name="policeDepartment">

                    <!-- Police Report Number field -->
                    <label for="policeReportNumber">Police Report Number:</label>
                    <input type="text" id="policeReportNumber" name="policeReportNumber">

                    <!-- Claim Close Date field -->
                    <label for="claimCloseDate">Claim Close Date:</label>
                    <input type="date" id="claimCloseDate" name="claimCloseDate">

                    <!-- Vehicle Odometer field -->
                    <label for="vehicleOdometer">Vehicle Odometer:</label>
                    <input type="number" id="vehicleOdometer" name="vehicleOdometer">

                    <!-- Description field -->
                    <label for="description">Description:</label>
                    <textarea id="description" name="description"></textarea>

                    <!-- Damage Type field with dynamic addition -->
                    <label for="damageType">Damage Type:</label>
                    <div>
                        <% damageTypes.forEach(type => { %> <!-- Loop through damage types from the database -->
                            <input type="checkbox" id="damageType_<%= type %>" name="damageType" value="<%= type %>">
                            <label for="damageType_<%= type %>"><%= type %></label><br>
                        <% }) %>
                    </div>
                    <div class="dynamic-field-container">
                        <input type="text" id="newDamageType" placeholder="New Damage Type"> <!-- Input for adding a new damage type -->
                        <button type="button" class="btn add-btn" onclick="addDamageType()">Add Damage Type</button> <!-- Button to add the new damage type -->
                    </div>

                    <!-- Status field with dynamic addition -->
                    <label for="status">Status:</label>
                    <select id="status" name="status">
                        <% statuses.forEach(status => { %> <!-- Loop through statuses from the database -->
                            <option value="<%= status %>"><%= status %></option>
                        <% }) %>
                    </select>
                    <div class="dynamic-field-container">
                        <input type="text" id="newStatus" placeholder="New Status"> <!-- Input for adding a new status -->
                        <button type="button" class="btn add-btn" onclick="addStatus()">Add Status</button> <!-- Button to add the new status -->
                    </div>

                    <!-- Renters Liability Insurance field -->
                    <label for="rentersLiabilityInsurance">Was Renters Liability Insurance purchased?</label>
                    <select id="rentersLiabilityInsurance" name="rentersLiabilityInsurance">
                        <option value="yes">Yes</option>
                        <option value="no">No</option>
                    </select>

                    <!-- Loss Damage Waiver field -->
                    <label for="lossDamageWaiver">Was Loss Damage Waiver purchased?</label>
                    <select id="lossDamageWaiver" name="lossDamageWaiver">
                        <option value="yes">Yes</option>
                        <option value="no">No</option>
                    </select>
                </div>

                <!-- File upload sections -->
                <div class="file-section">
                    <h3>Incident Reports</h3>
                    <input type="file" id="incidentReports" name="incidentReports" multiple>
                </div>

                <div class="file-section">
                    <h3>Correspondence</h3>
                    <input type="file" id="correspondence" name="correspondence" multiple>
                </div>

                <div class="file-section">
                    <h3>Rental Agreement</h3>
                    <input type="file" id="rentalAgreement" name="rentalAgreement" multiple>
                </div>

                <div class="file-section">
                    <h3>Police Report</h3>
                    <input type="file" id="policeReport" name="policeReport" multiple>
                </div>

                <div class="file-section">
                    <h3>Invoices</h3>
                    <input type="file" id="invoices" name="invoices" multiple>
                </div>

                <div class="file-section">
                    <h3>Photos</h3>
                    <input type="file" id="photos" name="photos" multiple>
                </div>

                <!-- Button group -->
                <div class="button-group">
                    <button type="submit" class="btn">Add Claim</button>
                    <a href="/claims" class="btn">Cancel</a>
                </div>
            </form>
        </div>
    </main>
    <script>
        // Function to add a new status dynamically
        async function addStatus() {
            const status = document.getElementById('newStatus').value;
            if (status) {
                const response = await fetch('/claims/statuses', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ status })
                });

                if (response.ok) {
                    const option = document.createElement('option');
                    option.value = status;
                    option.textContent = status;
                    document.getElementById('status').appendChild(option);
                    document.getElementById('newStatus').value = '';
                }
            }
        }

        // Function to add a new damage type dynamically
        async function addDamageType() {
            const damageType = document.getElementById('newDamageType').value;
            if (damageType) {
                const response = await fetch('/claims/damageTypes', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ damageType })
                });

                if (response.ok) {
                    const container = document.querySelector('#damageType_' + damageType);
                    if (!container) {
                        const checkbox = document.createElement('input');
                        checkbox.type = 'checkbox';
                        checkbox.id = 'damageType_' + damageType;
                        checkbox.name = 'damageType';
                        checkbox.value = damageType;

                        const label = document.createElement('label');
                        label.htmlFor = 'damageType_' + damageType;
                        label.textContent = damageType;

                        const br = document.createElement('br');

                        document.querySelector('#damageType').appendChild(checkbox);
                        document.querySelector('#damageType').appendChild(label);
                        document.querySelector('#damageType').appendChild(br);

                        document.getElementById('newDamageType').value = '';
                    }
                }
            }
        }

        // Function to add a new location dynamically
        async function addLocation() {
            const location = document.getElementById('newLocation').value;
            if (location) {
                const response = await fetch('/claims/locations', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ location })
                });

                if (response.ok) {
                    const option = document.createElement('option');
                    option.value = location;
                    option.textContent = location;
                    document.getElementById('rentingLocation').appendChild(option);
                    document.getElementById('newLocation').value = '';
                }
            }
        }
    </script>
</body>
</html>