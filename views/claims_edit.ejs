<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"> <!-- Set the character encoding for the document -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Ensure proper rendering and touch zooming on mobile devices -->
    <title>Edit Claim - Vortex Claims System</title> <!-- Title of the document -->
    <link rel="stylesheet" href="/css/styles.css"> <!-- Link to external CSS for styling -->
    <style>
        /* General button styling */
        .btn {
            display: inline-block;
            padding: 8px 12px;
            margin: 5px;
            background-color: #007bff;
            color: white;
            text-align: center;
            text-decoration: none;
            border-radius: 4px;
        }

        /* Button hover effect */
        .btn:hover {
            background-color: #0056b3;
        }

        /* Container styling */
        .container {
            max-width: 800px;
            margin: auto;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f9f9f9;
        }

        /* Form section styling */
        .claim-info {
            margin-bottom: 20px;
        }

        /* Label styling */
        .claim-info label {
            font-weight: bold;
        }

        /* Input, textarea, and select field styling */
        .claim-info input, .claim-info textarea, .claim-info select {
            width: 100%;
            padding: 8px;
            margin: 5px 0 15px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        /* File section styling */
        .file-section {
            margin-bottom: 20px;
        }

        /* File section headings */
        .file-section h3 {
            margin-bottom: 10px;
        }

        /* File input styling */
        .file-section input {
            margin-bottom: 10px;
        }

        /* Button group styling */
        .button-group {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
        }

        /* Checkbox group styling */
        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            margin: 5px 0 15px 0;
        }

        /* Checkbox labels styling */
        .checkbox-group label {
            width: 50%;
            padding: 5px;
        }

        /* Dynamic field container styling for adding/removing statuses, locations, and damage types */
        .dynamic-field-container {
            display: flex;
            align-items: center;
        }

        /* Input field within dynamic field container */
        .dynamic-field-container input {
            width: auto;
            flex-grow: 1;
        }

        /* Add button within dynamic field container */
        .dynamic-field-container .add-btn {
            margin-left: 10px;
            background-color: green;
        }

        /* Remove button within dynamic field container */
        .dynamic-field-container .remove-btn {
            background-color: red;
            color: white;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <header>
        <!-- Logo and navigation -->
        <img src="/images/VortexITLogo.png" alt="Vortex Logo" class="logo"> <!-- Company logo -->
        <h1>Vortex Claims System</h1> <!-- Main heading -->
        <nav>
            <ul>
                <li><a href="/dashboard">Dashboard</a></li> <!-- Link to Dashboard -->
                <li class="Claims">
                    <a href="javascript:void(0)" class="dropbtn">Claims</a> <!-- Dropdown trigger for claims -->
                    <div class="dropdown-content">
                        <a href="/claims/search">Search Claims</a> <!-- Link to Search Claims -->
                        <a href="/claims/add">Add Claim</a> <!-- Link to Add Claim -->
                    </div>
                </li>
                <li><a href="/reports">Reports</a></li> <!-- Link to Reports -->
                <li class="Settings">
                    <a href="javascript:void(0)" class="dropbtn">Settings</a> <!-- Dropdown trigger for settings -->
                    <div class="dropdown-content">
                        <a href="/user-management">User Management</a> <!-- Link to User Management -->
                        <a href="/email-templates">Email Templates</a> <!-- Link to Email Templates -->
                    </div>
                </li>
                <li><a href="/help">Help</a></li> <!-- Link to Help -->
                <li><a href="/logout">Logout</a></li> <!-- Link to Logout -->
            </ul>
        </nav>
    </header>
    <main>
        <div class="container">
            <h2>Edit Claim</h2> <!-- Section heading -->

            <!-- Form to edit claim details -->
            <form action="/claims/<%= claim._id %>?_method=PUT" method="POST" enctype="multipart/form-data">
                <div class="claim-info">
                    <label for="mva">MVA:</label> <!-- Label for MVA input -->
                    <input type="text" id="mva" name="mva" value="<%= claim.mva %>" required> <!-- Input for MVA number -->

                    <label for="customerName">Customer Name:</label> <!-- Label for customer name input -->
                    <input type="text" id="customerName" name="customerName" value="<%= claim.customerName %>" required> <!-- Input for customer name -->

                    <label for="customerNumber">Customer Number:</label> <!-- Label for customer number input -->
                    <input type="text" id="customerNumber" name="customerNumber" value="<%= claim.customerNumber %>"> <!-- Input for customer number -->

                    <label for="customerEmail">Customer Email:</label> <!-- Label for customer email input -->
                    <input type="email" id="customerEmail" name="customerEmail" value="<%= claim.customerEmail %>"> <!-- Input for customer email -->

                    <label for="customerAddress">Customer Address:</label> <!-- Label for customer address input -->
                    <input type="text" id="customerAddress" name="customerAddress" value="<%= claim.customerAddress %>"> <!-- Input for customer address -->

                    <label for="customerDriversLicense">Customer Drivers License:</label> <!-- Label for customer drivers license input -->
                    <input type="text" id="customerDriversLicense" name="customerDriversLicense" value="<%= claim.customerDriversLicense %>"> <!-- Input for customer drivers license -->

                    <label for="carMake">Car Make:</label> <!-- Label for car make input -->
                    <input type="text" id="carMake" name="carMake" value="<%= claim.carMake %>"> <!-- Input for car make -->

                    <label for="carModel">Car Model:</label> <!-- Label for car model input -->
                    <input type="text" id="carModel" name="carModel" value="<%= claim.carModel %>"> <!-- Input for car model -->

                    <label for="carYear">Car Year:</label> <!-- Label for car year input -->
                    <input type="text" id="carYear" name="carYear" value="<%= claim.carYear %>"> <!-- Input for car year -->

                    <label for="carColor">Car Color:</label> <!-- Label for car color input -->
                    <input type="text" id="carColor" name="carColor" value="<%= claim.carColor %>"> <!-- Input for car color -->

                    <label for="carVIN">Car VIN:</label> <!-- Label for car VIN input -->
                    <input type="text" id="carVIN" name="carVIN" value="<%= claim.carVIN %>"> <!-- Input for car VIN -->

                    <label for="accidentDate">Accident Date:</label> <!-- Label for accident date input -->
                    <input type="date" id="accidentDate" name="accidentDate" value="<%= claim.accidentDate ? new Date(claim.accidentDate).toISOString().split('T')[0] : '' %>"> <!-- Input for accident date -->

                    <label for="billable">Billable:</label> <!-- Label for billable selection -->
                    <select id="billable" name="billable"> <!-- Dropdown for billable selection -->
                        <option value="true" <%= claim.billable ? 'selected' : '' %>>Yes</option> <!-- Option for Yes -->
                        <option value="false" <%= !claim.billable ? 'selected' : '' %>>No</option> <!-- Option for No -->
                    </select>

                    <label for="isRenterAtFault">Is Renter At Fault:</label> <!-- Label for is renter at fault selection -->
                    <select id="isRenterAtFault" name="isRenterAtFault"> <!-- Dropdown for is renter at fault selection -->
                        <option value="true" <%= claim.isRenterAtFault ? 'selected' : '' %>>Yes</option> <!-- Option for Yes -->
                        <option value="false" <%= !claim.isRenterAtFault ? 'selected' : '' %>>No</option> <!-- Option for No -->
                    </select>

                    <label for="damagesTotal">Damages Total:</label> <!-- Label for damages total input -->
                    <input type="text" id="damagesTotal" name="damagesTotal" value="<%= claim.damagesTotal %>"> <!-- Input for damages total -->

                    <label for="bodyShopName">Body Shop Name:</label> <!-- Label for body shop name input -->
                    <input type="text" id="bodyShopName" name="bodyShopName" value="<%= claim.bodyShopName %>"> <!-- Input for body shop name -->

                    <label for="raNumber">RA Number:</label> <!-- Label for RA number input -->
                    <input type="text" id="raNumber" name="raNumber" value="<%= claim.raNumber %>"> <!-- Input for RA number -->

                    <label for="insuranceCarrier">Insurance Carrier:</label> <!-- Label for insurance carrier input -->
                    <input type="text" id="insuranceCarrier" name="insuranceCarrier" value="<%= claim.insuranceCarrier %>"> <!-- Input for insurance carrier -->

                    <label for="insuranceAdjuster">Insurance Adjuster:</label> <!-- Label for insurance adjuster input -->
                    <input type="text" id="insuranceAdjuster" name="insuranceAdjuster" value="<%= claim.insuranceAdjuster %>"> <!-- Input for insurance adjuster -->

                    <label for="insuranceEmail">Insurance Email:</label> <!-- Label for insurance email input -->
                    <input type="email" id="insuranceEmail" name="insuranceEmail" value="<%= claim.insuranceEmail %>"> <!-- Input for insurance email -->

                    <label for="insurancePhoneNumber">Insurance Phone Number:</label> <!-- Label for insurance phone number input -->
                    <input type="text" id="insurancePhoneNumber" name="insurancePhoneNumber" value="<%= claim.insurancePhoneNumber %>"> <!-- Input for insurance phone number -->

                    <label for="insuranceFaxNumber">Insurance Fax Number:</label> <!-- Label for insurance fax number input -->
                    <input type="text" id="insuranceFaxNumber" name="insuranceFaxNumber" value="<%= claim.insuranceFaxNumber %>"> <!-- Input for insurance fax number -->

                    <label for="insuranceAddress">Insurance Address:</label> <!-- Label for insurance address input -->
                    <input type="text" id="insuranceAddress" name="insuranceAddress" value="<%= claim.insuranceAddress %>"> <!-- Input for insurance address -->

                    <label for="insurancePolicyNumber">Insurance Policy Number:</label> <!-- Label for insurance policy number input -->
                    <input type="text" id="insurancePolicyNumber" name="insurancePolicyNumber" value="<%= claim.insurancePolicyNumber %>"> <!-- Input for insurance policy number -->

                    <label for="insuranceClaimNumber">Insurance Claim Number:</label> <!-- Label for insurance claim number input -->
                    <input type="text" id="insuranceClaimNumber" name="insuranceClaimNumber" value="<%= claim.insuranceClaimNumber %>"> <!-- Input for insurance claim number -->

                    <label for="thirdPartyName">Third Party Name:</label> <!-- Label for third party name input -->
                    <input type="text" id="thirdPartyName" name="thirdPartyName" value="<%= claim.thirdPartyName %>"> <!-- Input for third party name -->

                    <label for="thirdPartyAddress">Third Party Address:</label> <!-- Label for third party address input -->
                    <input type="text" id="thirdPartyAddress" name="thirdPartyAddress" value="<%= claim.thirdPartyAddress %>"> <!-- Input for third party address -->

                    <label for="thirdPartyPhoneNumber">Third Party Phone Number:</label> <!-- Label for third party phone number input -->
                    <input type="text" id="thirdPartyPhoneNumber" name="thirdPartyPhoneNumber" value="<%= claim.thirdPartyPhoneNumber %>"> <!-- Input for third party phone number -->

                    <label for="thirdPartyInsuranceName">Third Party Insurance Name:</label> <!-- Label for third party insurance name input -->
                    <input type="text" id="thirdPartyInsuranceName" name="thirdPartyInsuranceName" value="<%= claim.thirdPartyInsuranceName %>"> <!-- Input for third party insurance name -->

                    <label for="thirdPartyAdjusterName">Third Party Adjuster Name:</label> <!-- Label for third party adjuster name input -->
                    <input type="text" id="thirdPartyAdjusterName" name="thirdPartyAdjusterName" value="<%= claim.thirdPartyAdjusterName %>"> <!-- Input for third party adjuster name -->

                    <label for="thirdPartyPolicyNumber">Third Party Policy Number:</label> <!-- Label for third party policy number input -->
                    <input type="text" id="thirdPartyPolicyNumber" name="thirdPartyPolicyNumber" value="<%= claim.thirdPartyPolicyNumber %>"> <!-- Input for third party policy number -->

                    <label for="thirdPartyClaimNumber">Third Party Claim Number:</label> <!-- Label for third party claim number input -->
                    <input type="text" id="thirdPartyClaimNumber" name="thirdPartyClaimNumber" value="<%= claim.thirdPartyClaimNumber %>"> <!-- Input for third party claim number -->

                    <!-- Dropdown to select the Renting Location -->
                    <label for="rentingLocation">Renting Location:</label>
                    <select id="rentingLocation" name="rentingLocation">
                        <% rentingLocations.forEach(location => { %>
                            <option value="<%= location %>" <%= claim.rentingLocation === location ? 'selected' : '' %>><%= location %></option>
                        <% }) %>
                    </select>
                    <!-- Dynamic field for adding new locations -->
                    <div class="dynamic-field-container">
                        <input type="text" id="newLocation" placeholder="New Location">
                        <button type="button" class="btn add-btn" onclick="addLocation()">Add Location</button>
                    </div>

                    <!-- LDW (Loss Damage Waiver) Accepted dropdown -->
                    <label for="ldwAccepted">LDW Accepted:</label>
                    <select id="ldwAccepted" name="ldwAccepted">
                        <option value="true" <%= claim.ldwAccepted ? 'selected' : '' %>>Yes</option>
                        <option value="false" <%= !claim.ldwAccepted ? 'selected' : '' %>>No</option>
                    </select>

                    <!-- Police Department and Report Number -->
                    <label for="policeDepartment">Police Department:</label>
                    <input type="text" id="policeDepartment" name="policeDepartment" value="<%= claim.policeDepartment %>">

                    <label for="policeReportNumber">Police Report Number:</label>
                    <input type="text" id="policeReportNumber" name="policeReportNumber" value="<%= claim.policeReportNumber %>">

                    <!-- Claim Close Date -->
                    <label for="claimCloseDate">Claim Close Date:</label>
                    <input type="date" id="claimCloseDate" name="claimCloseDate" value="<%= claim.claimCloseDate ? new Date(claim.claimCloseDate).toISOString().split('T')[0] : '' %>">

                    <!-- Vehicle Odometer -->
                    <label for="vehicleOdometer">Vehicle Odometer:</label>
                    <input type="number" id="vehicleOdometer" name="vehicleOdometer" value="<%= claim.vehicleOdometer %>">

                    <!-- Description -->
                    <label for="description">Description:</label>
                    <textarea id="description" name="description" class="responsive-textarea"><%= claim.description %></textarea>

                    <!-- New fields for Renters Liability Insurance and Loss Damage Waiver -->
                    <label for="rentersLiabilityInsurance">Was Renters Liability Insurance purchased?</label>
                    <select id="rentersLiabilityInsurance" name="rentersLiabilityInsurance">
                        <option value="yes" <%= claim.rentersLiabilityInsurance === 'yes' ? 'selected' : '' %>>Yes</option>
                        <option value="no" <%= claim.rentersLiabilityInsurance === 'no' ? 'selected' : '' %>>No</option>
                    </select>

                    <label for="lossDamageWaiver">Was Loss Damage Waiver purchased?</label>
                    <select id="lossDamageWaiver" name="lossDamageWaiver">
                        <option value="yes" <%= claim.lossDamageWaiver === 'yes' ? 'selected' : '' %>>Yes</option>
                        <option value="no" <%= claim.lossDamageWaiver === 'no' ? 'selected' : '' %>>No</option>
                    </select>

                    <!-- Dynamic checkboxes for Damage Types -->
                    <label for="damageType">Damage Type:</label>
                    <div id="damageTypeContainer" class="checkbox-group">
                        <% damageTypes.forEach(type => { %>
                            <label>
                                <input type="checkbox" name="damageType" value="<%= type %>" <%= claim.damageType.includes(type) ? 'checked' : '' %>> <%= type %>
                            </label>
                        <% }) %>
                    </div>
                    <!-- Dynamic field for adding new damage types -->
                    <div class="dynamic-field-container">
                        <input type="text" id="newDamageType" placeholder="New Damage Type">
                        <button type="button" class="btn add-btn" onclick="addDamageType()">Add Damage Type</button>
                    </div>

                    <!-- Dropdown for selecting Status -->
                    <label for="status">Status:</label>
                    <select id="status" name="status">
                        <% statuses.forEach(status => { %>
                            <option value="<%= status %>" <%= claim.status === status ? 'selected' : '' %>><%= status %></option>
                        <% }) %>
                    </select>
                    <!-- Dynamic field for adding new statuses -->
                    <div class="dynamic-field-container">
                        <input type="text" id="newStatus" placeholder="New Status">
                        <button type="button" class="btn add-btn" onclick="addStatus()">Add Status</button>
                    </div>
                </div>

                <!-- File upload sections -->
                <div class="file-section">
                    <h3>Incident Reports</h3>
                    <input type="file" id="incidentReports" name="incidentReports" multiple>
                </div>

                <div class="file-section">
                    <h3>Correspondence</h3>
                    <input type="file" id="correspondence" name="correspondence" multiple>
                </div>

                <div class="file-section">
                    <h3>Rental Agreement</h3>
                    <input type="file" id="rentalAgreement" name="rentalAgreement" multiple>
                </div>

                <div class="file-section">
                    <h3>Police Report</h3>
                    <input type="file" id="policeReport" name="policeReport" multiple>
                </div>

                <div class="file-section">
                    <h3>Invoices</h3>
                    <input type="file" id="invoices" name="invoices" multiple>
                </div>

                <div class="file-section">
                    <h3>Photos</h3>
                    <input type="file" id="photos" name="photos" multiple>
                </div>

                <!-- Form submission buttons -->
                <div class="button-group">
                    <button type="submit" class="btn">Update Claim</button>
                    <a href="/claims/<%= claim._id %>" class="btn">Cancel</a>
                </div>
            </form>
        </div>
    </main>
    <script>
        // Function to add a new status
        async function addStatus() {
            const status = document.getElementById('newStatus').value;
            if (status) {
                const response = await fetch('/claims/statuses', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ status })
                });

                if (response.ok) {
                    const option = document.createElement('option');
                    option.value = status;
                    option.textContent = status;
                    document.getElementById('status').appendChild(option);
                    document.getElementById('newStatus').value = '';
                }
            }
        }

        // Function to add a new damage type
        async function addDamageType() {
            const damageType = document.getElementById('newDamageType').value;
            if (damageType) {
                const response = await fetch('/claims/damageTypes', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ damageType })
                });

                if (response.ok) {
                    const container = document.querySelector('#damageTypeContainer');
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.name = 'damageType';
                    checkbox.value = damageType;

                    const label = document.createElement('label');
                    label.appendChild(checkbox);
                    label.appendChild(document.createTextNode(' ' + damageType));

                    container.appendChild(label);

                    document.getElementById('newDamageType').value = '';
                }
            }
        }

        // Function to add a new location
        async function addLocation() {
            const location = document.getElementById('newLocation').value;
            if (location) {
                const response = await fetch('/claims/locations', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ location })
                });

                if (response.ok) {
                    const option = document.createElement('option');
                    option.value = location;
                    option.textContent = location;
                    document.getElementById('rentingLocation').appendChild(option);
                    document.getElementById('newLocation').value = '';
                }
            }
        }
    </script>
</body>
</html>